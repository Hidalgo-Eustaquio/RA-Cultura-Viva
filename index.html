<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>RA Cultura Viva</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  </head>
  <body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs="sourceType: webcam;">
      <a-assets>
        <a-asset-item id="modeloMapa" src="assets/modelos/mapa_peru.glb"></a-asset-item>
      </a-assets>

      <a-marker preset="hiro">
        <a-entity gltf-model="#modeloMapa" position="0 0 -1.5" scale="1.5 1.5 1.5" pinch-to-zoom mousewheel-zoom></a-entity>

        <!-- Caral -->
        <a-box class="clickable" position="-1.5 0.2 -1.2" depth="0.2" height="0.2" width="0.5" color="#FF5733"
              onclick="location.href='scenes/caral.html'"></a-box>
        <a-text value="Caral" position="-1.5 0.5 -1.2" align="center" color="white" width="2"></a-text>
        <a-cylinder position="-1.2 0.1 -1.3" radius="0.01" height="0.4" color="#FF5733" rotation="0 0 90"></a-cylinder>

        <!-- Chavín -->
        <a-box class="clickable" position="0 0.2 -1.2" depth="0.2" height="0.2" width="0.5" color="#33FF57"
              onclick="location.href='scenes/chavin.html'"></a-box>
        <a-text value="Chavín" position="0 0.5 -1.2" align="center" color="white" width="2"></a-text>
        <a-cylinder position="0.3 0.1 -1.3" radius="0.01" height="0.4" color="#33FF57" rotation="0 0 90"></a-cylinder>

        <!-- Paracas -->
        <a-box class="clickable" position="1.5 0.2 -1.2" depth="0.2" height="0.2" width="0.5" color="#3357FF"
              onclick="location.href='scenes/paracas.html'"></a-box>
        <a-text value="Paracas" position="1.5 0.5 -1.2" align="center" color="white" width="2"></a-text>
        <a-cylinder position="1.2 0.1 -1.3" radius="0.01" height="0.4" color="#3357FF" rotation="0 0 90"></a-cylinder>
      </a-marker>


      <a-entity camera>
        <a-cursor raycaster="objects: .clickable"></a-cursor>
      </a-entity>
    </a-scene>


    <script>
      AFRAME.registerComponent('pinch-to-zoom', {
        schema: { min: {default: 0.5}, max: {default: 3} },
        init: function () {
          const el = this.el;
          let initialDistance = null;
          let initialScale = el.object3D.scale.x;
          this.el.sceneEl.canvas.addEventListener('touchstart', (e) => {
            if (e.touches.length === 2) {
              const dx = e.touches[0].clientX - e.touches[1].clientX;
              const dy = e.touches[0].clientY - e.touches[1].clientY;
              initialDistance = Math.sqrt(dx * dx + dy * dy);
              initialScale = el.object3D.scale.x;
            }
          }, false);
          this.el.sceneEl.canvas.addEventListener('touchmove', (e) => {
            if (e.touches.length === 2 && initialDistance) {
              const dx = e.touches[0].clientX - e.touches[1].clientX;
              const dy = e.touches[0].clientY - e.touches[1].clientY;
              const currentDistance = Math.sqrt(dx * dx + dy * dy);
              let scaleFactor = currentDistance / initialDistance;
              scaleFactor = Math.max(this.data.min / initialScale, Math.min(this.data.max / initialScale, scaleFactor));
              el.object3D.scale.setScalar(initialScale * scaleFactor);
            }
          }, false);
        }
      });

      AFRAME.registerComponent('mousewheel-zoom', {
        schema: { min: {default: 0.5}, max: {default: 3}, sensitivity: {default: 0.05} },
        init: function () {
          const el = this.el;
          const self = this;
          window.addEventListener('wheel', function (e) {
            const scale = el.object3D.scale.x;
            const delta = e.deltaY > 0 ? -self.data.sensitivity : self.data.sensitivity;
            let newScale = scale + delta;
            newScale = Math.max(self.data.min, Math.min(self.data.max, newScale));
            el.object3D.scale.set(newScale, newScale, newScale);
          });
        }
      });
    </script>
  </body>
</html>
