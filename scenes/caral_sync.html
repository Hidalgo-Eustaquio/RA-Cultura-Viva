
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Cultura Caral (con subtítulos)</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <link rel="stylesheet" href="../style.css">
  </head>
  <body>
    <a-scene>
      <a-assets>
        <a-asset-item id="modeloCaral" src="../assets/models/caral.glb"></a-asset-item>
        <audio id="audioCaral" src="../assets/audio/caral.mp3" preload="auto"></audio>
      </a-assets>

      <!-- Modelo y título -->
      <a-entity gltf-model="#modeloCaral" position="0 0 -3" scale="2 2 2"></a-entity>
      <a-text value="Cultura Caral: Primera civilización de América" position="0 2.5 -3" align="center" width="6" color="#FFFFFF"></a-text>

      <!-- Subtítulo sincronizado -->
      <a-text id="subtitulo" value="" position="0 2 -3" align="center" width="5" color="yellow"></a-text>

      <!-- Audio -->
      <a-entity id="narracion" sound="src: #audioCaral; autoplay: true"></a-entity>

      <!-- Botón de regreso -->
      <a-box position="0 0.3 -2" width="1.5" height="0.5" depth="0.1" color="#4CAF50"
             event-set__enter="_event: mouseenter; color: #81C784"
             event-set__leave="_event: mouseleave; color: #4CAF50"
             onclick="window.location.href='../index.html'">
      </a-box>
      <a-text value="Volver al Mapa" position="0 0.5 -2.01" align="center" width="3"></a-text>

      <!-- Script de subtítulos sincronizados -->
      <script>
        const subtitulos = [
          { tiempo: 0, texto: "Bienvenidos a la Cultura Caral." },
          { tiempo: 4, texto: "Caral fue la primera civilización de América." },
          { tiempo: 8, texto: "Se desarrolló hace más de 5000 años en Perú." },
          { tiempo: 12, texto: "Fue descubierta por Ruth Shady en 1994." },
          { tiempo: 16, texto: "Su arquitectura incluye pirámides y plazas circulares." },
          { tiempo: 20, texto: "Gracias por explorar la Cultura Caral." }
        ];

        const audio = document.querySelector("#narracion").components.sound.pool.children[0];
        const subtitulo = document.querySelector("#subtitulo");

        function mostrarSubtitulo() {
          const tiempo = audio.currentTime;
          for (let i = subtitulos.length - 1; i >= 0; i--) {
            if (tiempo >= subtitulos[i].tiempo) {
              subtitulo.setAttribute("value", subtitulos[i].texto);
              break;
            }
          }
        }

        audio.addEventListener("timeupdate", mostrarSubtitulo);
        setInterval(mostrarSubtitulo, 500);
      </script>
    </a-scene>
  </body>
</html>
